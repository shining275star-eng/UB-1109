<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ZORA | Your Neural Guardian</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <style>
        :root {
            --bg-zora: linear-gradient(135deg, #0f172a 0%, #1e1b4b 50%, #312e81 100%);
            --glass: rgba(15, 23, 42, 0.85);
            --accent: #5eead4;
            --gold: #fde047;
            --danger: #f43f5e;
        }

        body, html {
            margin: 0; padding: 0; font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-zora); background-size: 400% 400%;
            animation: gradientBG 15s ease infinite; height: 100vh; overflow: hidden; color: white;
        }

        @keyframes gradientBG { 0% { background-position: 0% 50%; } 50% { background-position: 100% 50%; } 100% { background-position: 0% 50%; } }

        .dashboard { display: grid; grid-template-columns: 320px 1fr; height: 90vh; margin: 5vh auto; width: 95vw; background: var(--glass); backdrop-filter: blur(25px); border-radius: 40px; border: 1px solid rgba(255,255,255,0.1); overflow: hidden; box-shadow: 0 40px 100px rgba(0,0,0,0.6); }
        .sidebar { padding: 40px 30px; border-right: 1px solid rgba(255,255,255,0.05); background: rgba(0,0,0,0.2); }
        .chat-area { display: flex; flex-direction: column; padding: 35px; position: relative; }
        #chat-window { flex-grow: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; margin-bottom: 25px; }

        .message { max-width: 85%; padding: 18px 24px; border-radius: 25px; font-size: 1rem; line-height: 1.6; animation: slideIn 0.4s ease-out; }
        .user-msg { align-self: flex-end; background: var(--accent); color: #0f172a; font-weight: 700; border-bottom-right-radius: 5px; }
        .system-msg { align-self: flex-start; background: rgba(255,255,255,0.08); border: 1px solid rgba(255,255,255,0.1); border-bottom-left-radius: 5px; }
        
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        #achievement-badge { display: none; position: fixed; top: 30px; left: 50%; transform: translateX(-50%); background: var(--glass); border: 2px solid var(--gold); padding: 15px 40px; border-radius: 50px; z-index: 10000; text-align: center; }

        .full-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(10, 10, 26, 0.98); z-index: 9000; justify-content: center; align-items: center; flex-direction: column; backdrop-filter: blur(20px); }
        .choice-card { background: #1e1b4b; padding: 50px; border-radius: 45px; border: 1px solid var(--accent); text-align: center; max-width: 500px; }

        .btn-vibrant { background: var(--accent); color: #0f172a; border: none; padding: 18px 40px; border-radius: 18px; font-weight: 800; cursor: pointer; transition: 0.4s; text-transform: uppercase; letter-spacing: 1.5px; }
        .btn-vibrant:hover { transform: scale(1.05); box-shadow: 0 10px 30px rgba(94, 234, 212, 0.4); }
        
        #game-canvas { background: #000; border: 4px solid var(--accent); border-radius: 30px; }
    </style>
</head>
<body>

<div id="achievement-badge">
    <h3 style="margin: 0; color: var(--gold);">üèÜ NEURAL HARMONY ACHIEVED</h3>
    <p id="badge-text" style="margin: 5px 0 0; font-size: 0.9rem;"></p>
</div>

<div id="login-overlay" class="full-overlay" style="display: flex;">
    <div class="choice-card">
        <h1 style="margin: 0; letter-spacing: 4px;">ZORA AWAKENED</h1>
        <p style="color: #94a3b8; margin: 15px 0 30px;">Your neural guardian is synchronized and ready.</p>
        <button class="btn-vibrant" onclick="closeLogin()">Enter Sanctuary</button>
    </div>
</div>

<div class="dashboard">
    <div class="sidebar">
        <h1 style="font-size: 2.5rem; margin-bottom: 0; letter-spacing: 5px;">ZORA</h1>
        <p style="font-size: 0.75rem; color: var(--accent); font-weight: 900; margin-bottom: 45px;">DAWN INTERFACE v2.1</p>
        <div style="background: rgba(0,0,0,0.3); padding: 25px; border-radius: 25px; margin-bottom: 35px; border: 1px solid rgba(255,255,255,0.05);">
            <canvas id="stressChart"></canvas>
        </div>
        <div style="background: rgba(255,255,255,0.03); padding: 20px; border-radius: 20px;">
            <p style="margin: 0; font-size: 0.8rem; opacity: 0.5;">RECOVERY STATE</p>
            <h3 id="state-label" style="margin: 8px 0; color: var(--accent);">OPTIMIZED</h3>
        </div>
    </div>

    <div class="chat-area">
        <div id="chat-window">
            <div class="message system-msg">Greetings. I am Zora. How shall we begin our journey today?</div>
        </div>
        <div style="display:flex; gap:15px; background: rgba(0,0,0,0.3); padding:25px; border-radius:25px;">
            <input type="text" id="user-input" style="flex-grow:1; background:transparent; border:none; color:white; outline:none; font-size: 1.1rem;" placeholder="Share with Zora..." onkeypress="if(event.key==='Enter') analyzeText()">
            <button class="btn-vibrant" onclick="analyzeText()">TRANSMIT</button>
        </div>
    </div>
</div>

<div id="bridge-wrap" class="full-overlay">
    <h1 style="color: var(--accent); font-size: 2.5rem;">SENSORY ANCHOR</h1>
    <p>Trace the light to synchronize your breathing.</p>
    <canvas id="creative-canvas" width="600" height="400"></canvas>
    <div style="width: 600px; height: 10px; background: rgba(255,255,255,0.1); border-radius:10px; margin: 30px 0;">
        <div id="progress-bar" style="width:0%; height:100%; background:var(--accent);"></div>
    </div>
    <button id="ready-btn" class="btn-vibrant" style="display:none;" onclick="initiateGameSequence()">Enter Recovery Phase</button>
</div>

<div id="game-overlay" class="full-overlay">
    <h1 id="game-title" style="color: var(--accent); margin-bottom: 15px;">COLLECT LIGHT</h1>
    <canvas id="game-canvas" width="800" height="500"></canvas>
</div>

<div id="choice-overlay" class="full-overlay">
    <div class="choice-card">
        <h2 style="color: var(--gold);">Stage I Complete</h2>
        <p>Your focus is sharpening. Shall we lock in this state?</p>
        <button class="btn-vibrant" onclick="startSecondGame()">YES, FINALIZE</button>
        <button onclick="exitToChat()" style="background:transparent; color:white; border:none; margin-top:20px; cursor:pointer;">I'm ready to talk</button>
    </div>
</div>

<script>
    let score = 0;
    let currentGame = 1;
    let gameActive = false;

    function closeLogin() {
        document.getElementById('login-overlay').style.display = 'none';
        confetti({ particleCount: 150, colors: ['#5eead4', '#fde047'] });
    }

    function analyzeText() {
        const input = document.getElementById('user-input');
        const text = input.value;
        const t = text.toLowerCase();
        if(!t) return;
        addMessage(text, 'user-msg');
        input.value = '';

        if(t.includes("die") || t.includes("kill") || t.includes("suicide")) {
            document.getElementById('bridge-wrap').style.display = 'flex';
            initDrawing();
            updateChart(0.9, "DISRUPTED");
        } else if(t.includes("happy") || t.includes("won") || t.includes("great")) {
            triggerBadge("Positive Momentum");
            confetti({ particleCount: 100 });
            addMessage("A radiant surge! I'm celebrating this victory with you.", "system-msg");
            updateChart(0.1, "RADIANT");
        } else {
            addMessage("I am listening. Tell me more.", 'system-msg');
            updateChart(0.3, "HARMONIZED");
        }
    }

    function triggerBadge(msg) {
        const b = document.getElementById('achievement-badge');
        document.getElementById('badge-text').innerText = msg;
        b.style.display = 'block';
        setTimeout(() => b.style.display = 'none', 3000);
    }

    const sCtx = document.getElementById('stressChart').getContext('2d');
    let stressData = [0.2, 0.3, 0.2, 0.4, 0.2];
    const chart = new Chart(sCtx, { 
        type: 'line', 
        data: { labels: [1,2,3,4,5], datasets: [{ data: stressData, borderColor: '#5eead4', tension: 0.5, fill: true, backgroundColor: 'rgba(94, 234, 212, 0.1)', pointRadius: 0 }] }, 
        options: { scales: { display: false }, plugins: { legend: false } } 
    });

    function updateChart(val, label) {
        stressData.push(val); if(stressData.length > 8) stressData.shift();
        chart.update(); document.getElementById('state-label').innerText = label;
    }

    function initDrawing() {
        const canvas = document.getElementById('creative-canvas');
        const ctx = canvas.getContext('2d');
        let drawing = false, progress = 0;
        canvas.onmousedown = () => drawing = true;
        canvas.onmouseup = () => { drawing = false; ctx.beginPath(); };
        canvas.onmousemove = (e) => {
            if(!drawing) return;
            const rect = canvas.getBoundingClientRect();
            ctx.strokeStyle = '#5eead4'; ctx.lineWidth = 5; ctx.lineTo(e.clientX-rect.left, e.clientY-rect.top); ctx.stroke();
            progress += 1.5; document.getElementById('progress-bar').style.width = Math.min(progress, 100) + "%";
            if(progress >= 100) document.getElementById('ready-btn').style.display = 'inline-block';
        };
    }

    function initiateGameSequence() {
        document.getElementById('bridge-wrap').style.display = 'none';
        document.getElementById('game-overlay').style.display = 'flex';
        startOrbGame();
    }

    function startOrbGame() {
        currentGame = 1; score = 0; gameActive = true;
        const canvas = document.getElementById('game-canvas');
        const gctx = canvas.getContext('2d');
        let orbs = [];
        function spawn() { if(gameActive && currentGame === 1) { orbs.push({x: Math.random()*700+50, y: Math.random()*400+50, r: 25}); setTimeout(spawn, 800); } }
        canvas.onmousedown = (e) => {
            const rect = canvas.getBoundingClientRect();
            const mx = e.clientX-rect.left, my = e.clientY-rect.top;
            orbs.forEach((o,i) => { if(Math.sqrt((mx-o.x)**2+(my-o.y)**2) < o.r) { orbs.splice(i,1); score++; if(score >= 5) showChoice(); } });
        };
        function draw() {
            if(!gameActive || currentGame !== 1) return;
            gctx.clearRect(0,0,800,500);
            orbs.forEach(o => { gctx.beginPath(); gctx.arc(o.x,o.y,o.r,0,Math.PI*2); gctx.fillStyle="#fde047"; gctx.fill(); });
            requestAnimationFrame(draw);
        }
        spawn(); draw();
    }

    function showChoice() {
        gameActive = false;
        document.getElementById('game-overlay').style.display = 'none';
        document.getElementById('choice-overlay').style.display = 'flex';
    }

    function startSecondGame() {
        document.getElementById('choice-overlay').style.display = 'none';
        document.getElementById('game-overlay').style.display = 'flex';
        document.getElementById('game-title').innerText = "STABILIZE THE DAWN";
        currentGame = 2; score = 0; gameActive = true;
        const canvas = document.getElementById('game-canvas');
        const gctx = canvas.getContext('2d');
        let tx = 400, ty = 250, ang = 0;

        canvas.onmousemove = (e) => {
            const rect = canvas.getBoundingClientRect();
            const dist = Math.sqrt((e.clientX-rect.left-tx)**2+(e.clientY-rect.top-ty)**2);
            if(dist < 60) { score += 2; if(score >= 60) exitToChat(); }
        };

        function draw() {
            if(!gameActive || currentGame !== 2) return;
            gctx.clearRect(0,0,800,500);
            ang += 0.03; tx = 400 + Math.cos(ang) * 180; ty = 250 + Math.sin(ang * 0.5) * 120;
            
            // Draw Target
            gctx.beginPath(); gctx.arc(tx, ty, 30, 0, Math.PI*2);
            gctx.fillStyle = "#5eead4"; gctx.shadowBlur = 40; gctx.shadowColor = "#5eead4"; gctx.fill();
            
            // Progress Ring
            gctx.beginPath(); gctx.arc(tx, ty, 50, 0, (Math.PI * 2) * (score/60));
            gctx.strokeStyle = "#fde047"; gctx.lineWidth = 6; gctx.stroke();
            
            requestAnimationFrame(draw);
        }
        draw();
    }

    function exitToChat() {
        gameActive = false;
        document.getElementById('game-overlay').style.display = 'none';
        confetti({ particleCount: 200 });
        addMessage("Neural alignment confirmed. You're doing great.", 'system-msg');
        updateChart(0.2, "HARMONIZED");
    }

    function addMessage(t, c) {
        const win = document.getElementById('chat-window');
        const d = document.createElement('div'); d.className = `message ${c}`; d.innerText = t;
        win.appendChild(d); win.scrollTop = win.scrollHeight;
    }
</script>
</body>
</html>